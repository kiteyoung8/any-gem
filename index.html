/ åƒ…æ›¿æ› handleSend å‡½å¼å€å¡Š /
async function handleSend() {
    const text = input.value.trim();
    if(!text && !activeFileBase64) return;
    addMessage('user', text); input.value = '';
    setLoading(true, "AI Processing...");
    
    // ç²å–ç°¡å ±å°ˆå±¬è¨­å®š
    let extra = null;
    if(modeSelect.value === 'presentation') {
        const themeVal = document.getElementById('ppt-theme').value;
        extra = {
            strategy: document.getElementById('ppt-strategy').value,
            theme: themeVal,
            customStyle: (themeVal === 'Custom') ? document.getElementById('ppt-custom-style').value : ""
        };
    }

    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            // ä¿®æ­£é»: ç¢ºä¿ body åŒ…å« options
            body: JSON.stringify({ 
                message: text, 
                mode: modeSelect.value, 
                imageBase64: activeFileBase64, 
                mimeType: activeFileMime, 
                options: extra 
            }) 
        });
        const data = await res.json();
        activeFileBase64 = null;
        if(data.status === "success") {
            addMessage('ai', data.reply, { docUrl: data.docUrl, model: data.model });
        } else {
            addMessage('ai', "ğŸš¨ Error: " + data.error);
        }
    } catch (e) { 
        addMessage('ai', "âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥å¾Œç«¯æ—¥èªŒã€‚"); 
    } finally { 
        setLoading(false); 
    }
}
